const fs = require('fs');
const path = require('path');
const cloudinary = require('cloudinary').v2;
require('dotenv').config({ path: '.env.local' });

// Configure Cloudinary
cloudinary.config({
    cloud_name: process.env.CLOUDINARY_CLOUD_NAME,
    api_key: process.env.CLOUDINARY_API_KEY,
    api_secret: process.env.CLOUDINARY_API_SECRET,
});

// Image extensions to upload
const IMAGE_EXTENSIONS = ['.png', '.jpg', '.jpeg', '.gif', '.webp', '.JPG', '.PNG', '.JPEG'];

// Skip these files (not team member images)
const SKIP_FILES = ['file.svg', 'globe.svg', 'next.svg', 'vercel.svg', 'window.svg'];

async function uploadAllImages() {
    const publicDir = path.join(__dirname, 'public');
    const constantsPath = path.join(__dirname, 'src/lib/constants.ts');

    if (!fs.existsSync(publicDir)) {
        console.error('Public directory not found');
        return;
    }

    // Get all image files
    const files = fs.readdirSync(publicDir).filter(file => {
        const ext = path.extname(file);
        return IMAGE_EXTENSIONS.includes(ext) && !SKIP_FILES.includes(file);
    });

    console.log(`Found ${files.length} images to upload...\n`);

    const uploadedImages = {};

    for (const file of files) {
        const filePath = path.join(publicDir, file);
        const baseName = path.basename(file, path.extname(file));

        console.log(`Uploading ${file}...`);

        try {
            const result = await cloudinary.uploader.upload(filePath, {
                folder: 'scpc-team',
                public_id: baseName,
                overwrite: true,
                resource_type: 'image',
                timeout: 120000,
            });

            // Generate optimized URL with transformation
            const optimizedUrl = cloudinary.url(result.public_id, {
                width: 400,
                height: 400,
                crop: 'fill',
                gravity: 'face',
                quality: 'auto',
                fetch_format: 'auto',
                secure: true
            });

            uploadedImages[baseName] = optimizedUrl;
            console.log(`  ✓ Uploaded: ${optimizedUrl}\n`);
        } catch (err) {
            console.error(`  ✗ Failed to upload ${file}:`, err.message);
        }
    }

    // Generate the constants file content with new filenames
    const constantsContent = `// Global Image Constants - Cloudinary Optimized URLs
// Auto-generated by upload-constants.js on ${new Date().toISOString()}

export const SCPC_LOGO_URL = "${uploadedImages['scpc'] || ''}";

// Team member images (Cloudinary optimized)
export const TEAM_IMAGES = {
  AAYUSH: "${uploadedImages['aayush_new'] || ''}",
  AYUSH: "${uploadedImages['ayush_new'] || ''}",
  CHETAN: "${uploadedImages['chetan_new'] || ''}",
  CORE: "${uploadedImages['core_new'] || ''}",
  KANCHAN: "${uploadedImages['kanchan_new'] || ''}",
  KASHISH: "${uploadedImages['kashish_new'] || ''}",
  KSHTIJ: "${uploadedImages['kshtij_new'] || ''}",
  PRAGNESH: "${uploadedImages['Pragnesh_new'] || ''}",
  PRANJAL: "${uploadedImages['pranjal_new'] || ''}",
  PURVA: "${uploadedImages['purva_new'] || ''}",
  ROHAN: "${uploadedImages['rohan_new'] || ''}",
  RUDRA: "${uploadedImages['rudra_new'] || ''}",
  SHIVAM: "${uploadedImages['shivam_new'] || ''}",
  SHREYANSH: "${uploadedImages['shreyansh_new'] || ''}",
  SWAMINI: "${uploadedImages['swamini_new'] || ''}",
} as const;

// Name to image URL mapping for TeamTree component
export const MEMBER_IMAGE_URLS: Record<string, string> = {
  "Aayush Dubey": "${uploadedImages['aayush_new'] || ''}",
  "Swamini Yesade": "${uploadedImages['swamini_new'] || ''}",
  "Chetan Sharma": "${uploadedImages['chetan_new'] || ''}",
  "Ayush Dubey": "${uploadedImages['ayush_new'] || ''}",
  "Pranjal Chavan": "${uploadedImages['pranjal_new'] || ''}",
  "Rudra Sharma": "${uploadedImages['rudra_new'] || ''}",
  "Kanchan Saini": "${uploadedImages['kanchan_new'] || ''}",
  "Kshitij Yadav": "${uploadedImages['kshtij_new'] || ''}",
  "Shreyansh Singh": "${uploadedImages['shreyansh_new'] || ''}",
  "Purva Gade": "${uploadedImages['purva_new'] || ''}",
  "Shivam Pandey": "${uploadedImages['shivam_new'] || ''}",
  "Pragnesh Dubey": "${uploadedImages['Pragnesh_new'] || ''}",
  "Rohan Dol": "${uploadedImages['rohan_new'] || ''}",
  "Kashish": "${uploadedImages['kashish_new'] || ''}",
  "Amitabh Dwivedi": "",
  "Adnan Qureshi": "",
};
`;

    fs.writeFileSync(constantsPath, constantsContent, 'utf8');
    console.log('\n✅ Updated src/lib/constants.ts with Cloudinary URLs');
    console.log('\nUploaded images summary:');
    Object.entries(uploadedImages).forEach(([name, url]) => {
        console.log(`  ${name}: ${url}`);
    });
}

uploadAllImages().catch(console.error);
